<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NefroQuest Ascension</title>
  <style>
    :root {
      --bg1: #070b1f;
      --bg2: #132046;
      --card: rgba(15, 23, 42, .86);
      --line: rgba(148, 163, 184, .25);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --cyan: #22d3ee;
      --violet: #818cf8;
      --good: #22c55e;
      --bad: #ef4444;
      --legendary: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: Inter, Segoe UI, Roboto, sans-serif;
      background:
        radial-gradient(circle at 10% 8%, rgba(34, 211, 238, .2), transparent 36%),
        radial-gradient(circle at 85% 5%, rgba(129, 140, 248, .2), transparent 40%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 16px;
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      backdrop-filter: blur(8px);
      box-shadow: 0 18px 42px rgba(0,0,0,.35);
    }
    .left { padding: 16px; }
    .right { padding: 20px; }
    h1 {
      margin: 0 0 4px;
      font-size: 1.5rem;
      background: linear-gradient(90deg, #67e8f9, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle { margin: 0 0 14px; color: #cbd5e1; font-size: .9rem; }

    .hud {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 12px;
    }
    .tile {
      background: rgba(15,23,42,.65);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 8px;
      text-align: center;
    }
    .tile span { display: block; color: var(--muted); font-size: .72rem; }
    .tile strong { font-size: 1rem; }

    .avatar-card {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(2,6,23,.5);
      padding: 12px;
      margin-bottom: 12px;
    }
    .avatar-wrap {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .avatar {
      width: 76px;
      height: 76px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 2rem;
      border: 2px solid rgba(103,232,249,.6);
      background: radial-gradient(circle at 30% 20%, rgba(103,232,249,.35), rgba(15,23,42,.3) 60%);
      box-shadow: 0 0 20px rgba(103,232,249,.25);
    }
    .avatar.legendary {
      border-color: rgba(245,158,11,.8);
      box-shadow: 0 0 24px rgba(245,158,11,.35);
    }
    .xp-track {
      margin-top: 8px;
      background: #0b1221;
      border: 1px solid var(--line);
      border-radius: 999px;
      height: 10px;
      overflow: hidden;
    }
    .xp-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--cyan), var(--violet));
      transition: width .25s ease;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
      margin-top: 10px;
    }
    .stat { font-size: .82rem; color: #dbeafe; }

    .equip {
      margin-top: 12px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(15,23,42,.55);
      padding: 10px;
    }
    .equip-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
      margin-top: 8px;
    }
    .slot {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px;
      background: rgba(2,6,23,.6);
      font-size: .82rem;
    }
    .rarity-common { color: #cbd5e1; }
    .rarity-rare { color: #93c5fd; }
    .rarity-epic { color: #c4b5fd; }
    .rarity-legendary { color: #fbbf24; }

    .log {
      margin-top: 10px;
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 8px;
      min-height: 84px;
      font-size: .8rem;
      color: #cbd5e1;
    }

    #questionBox {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(2,6,23,.6);
      padding: 14px;
      margin-bottom: 12px;
    }
    #question { margin: 0; line-height: 1.5; font-size: 1.08rem; }
    .options { display: grid; gap: 10px; }
    .option {
      border: 1px solid var(--line);
      background: rgba(15,23,42,.65);
      color: var(--text);
      border-radius: 12px;
      padding: 12px;
      text-align: left;
      cursor: pointer;
      transition: .18s ease;
      font-size: .96rem;
    }
    .option:hover:not(:disabled) { border-color: rgba(34,211,238,.8); transform: translateY(-1px); }
    .option.correct { border-color: var(--good); background: rgba(34,197,94,.16); }
    .option.wrong { border-color: var(--bad); background: rgba(239,68,68,.16); }

    .feedback {
      margin-top: 12px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(2,6,23,.65);
      padding: 12px;
      line-height: 1.45;
      min-height: 72px;
    }
    .feedback.good { border-color: rgba(34,197,94,.55); }
    .feedback.bad { border-color: rgba(239,68,68,.55); }

    .refs {
      margin-top: 8px;
      font-size: .9rem;
      color: #cbd5e1;
    }
    .refs ul { margin: 8px 0 0; padding-left: 18px; }
    .refs a { color: #67e8f9; text-decoration: none; }
    .refs a:hover { text-decoration: underline; }

    .controls { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
    .btn {
      border: 0;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, var(--cyan), var(--violet));
      cursor: pointer;
    }
    .btn.secondary { background: #334155; }
    .hidden { display: none; }

    @media (max-width: 980px) {
      .container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="container">
    <section class="panel left">
      <h1>NefroQuest Ascension</h1>
      <p class="subtitle">RPG de nefrologia com loot, equipamentos e progress√£o visual.</p>

      <div class="hud">
        <div class="tile"><span>N√≠vel</span><strong id="level">1</strong></div>
        <div class="tile"><span>Recorde</span><strong id="record">0</strong></div>
        <div class="tile"><span>Pontos</span><strong id="score">0</strong></div>
        <div class="tile"><span>Vidas</span><strong id="lives">‚ù§‚ù§‚ù§</strong></div>
      </div>

      <div class="avatar-card">
        <div class="avatar-wrap">
          <div id="avatar" class="avatar">üßô</div>
          <div>
            <strong id="heroName">Guardi√£o Glomerular</strong><br />
            <small id="heroTitle" style="color:#94a3b8;">Aprendiz do N√©fron</small>
          </div>
        </div>
        <div class="xp-track"><div id="xpFill" class="xp-fill"></div></div>
        <small id="xpText" style="color:#94a3b8;">XP 0 / 120</small>

        <div class="stats">
          <div class="stat">‚öîÔ∏è Ataque: <strong id="statAtk">0</strong></div>
          <div class="stat">üõ°Ô∏è Defesa: <strong id="statDef">0</strong></div>
          <div class="stat">üß† Conhecimento: <strong id="statKno">0</strong></div>
          <div class="stat">üçÄ Sorte: <strong id="statLuck">0</strong></div>
          <div class="stat">üí∞ Ouro: <strong id="gold">0</strong></div>
          <div class="stat">üî• Streak: <strong id="streak">0</strong></div>
        </div>
      </div>

      <div class="equip">
        <strong>Equipamentos</strong>
        <div id="equipGrid" class="equip-grid"></div>
      </div>

      <div class="log" id="lootLog">Nenhum loot ainda. Acerte para dropar itens.</div>
    </section>

    <section class="panel right">
      <div id="questionBox">
        <p id="question"></p>
      </div>
      <div id="options" class="options"></div>
      <div id="feedback" class="feedback">Escolha uma alternativa para iniciar.</div>
      <div id="refs" class="refs"></div>
      <div class="controls">
        <button id="nextBtn" class="btn hidden">Pr√≥xima batalha</button>
        <button id="restartBtn" class="btn secondary hidden">Recome√ßar jornada</button>
      </div>
    </section>
  </main>

  <script>
    const referenceMap = {
      kdigo_ckd: { label: "KDIGO CKD 2024", url: "https://kdigo.org/guidelines/ckd-evaluation-and-management/" },
      kdigo_aki: { label: "KDIGO AKI", url: "https://kdigo.org/guidelines/acute-kidney-injury/" },
      kdigo_gn: { label: "KDIGO Glomerular Diseases", url: "https://kdigo.org/guidelines/glomerular-diseases/" },
      kdigo_mbd: { label: "KDIGO CKD-MBD", url: "https://kdigo.org/guidelines/ckd-mineral-and-bone-disorder/" },
      dapa: { label: "DAPA-CKD (NEJM)", url: "https://www.nejm.org/doi/full/10.1056/NEJMoa2024816" },
      empa: { label: "EMPA-KIDNEY (NEJM)", url: "https://www.nejm.org/doi/full/10.1056/NEJMoa2204233" },
      hypona: { label: "European Hyponatraemia Guideline", url: "https://academic.oup.com/ndt/article/29/suppl_2/i1/1843686" },
      kdoqi: { label: "KDOQI Nutrition in CKD", url: "https://www.kidney.org/professionals/guidelines/guidelines_commentaries" },
      transplant: { label: "KDIGO Transplant Recipient Care", url: "https://kdigo.org/guidelines/transplant-recipient-care/" }
    };

    const questions = [
      { d:1, q:"Em DRC est√°vel, exame inicial para rastrear albumin√∫ria?", o:["ACR urin√°ria em amostra isolada","Urocultura seriada","Urina de 24h para todos","Apenas creatinina"], a:0, e:"A rela√ß√£o albumina/creatinina em amostra isolada √© m√©todo pr√°tico e recomendado.", r:["kdigo_ckd"] },
      { d:1, q:"Classe de f√°rmacos base para DRC albumin√∫rica?", o:["AINE","IECA/BRA","Macrol√≠deo","Benzodiazep√≠nico"], a:1, e:"Bloqueio do SRAA reduz albumin√∫ria e desacelera progress√£o em pacientes eleg√≠veis.", r:["kdigo_ckd"] },
      { d:1, q:"No estadiamento de DRC, KDIGO combina:", o:["S√≥ TFG","S√≥ protein√∫ria","TFG + albumin√∫ria","S√≥dio + ureia"], a:2, e:"A estratifica√ß√£o de risco integra categoria G (TFG) e A (albumin√∫ria).", r:["kdigo_ckd"] },
      { d:2, q:"Hipercalemia grave com ECG alterado: primeira conduta?", o:["Bicarbonato oral","Gluconato de c√°lcio IV","Diur√©tico oral","Resina isolada"], a:1, e:"C√°lcio IV estabiliza membrana mioc√°rdica e reduz risco de arritmia imediata.", r:["kdigo_aki"] },
      { d:2, q:"Achado cl√°ssico de IRA pr√©-renal (sem diur√©tico)?", o:["FENa >2%","FENa <1%","Urina isosten√∫rica fixa","Na urin√°rio sempre >40"], a:1, e:"Na hipoperfus√£o pr√©-renal, o rim ret√©m s√≥dio e a FENa tende a ser baixa.", r:["kdigo_aki"] },
      { d:2, q:"Indica√ß√£o de iniciar iSGLT2 em DRC diab√©tica visa principalmente:", o:["Aumentar apetite","Nefroprote√ß√£o e redu√ß√£o CV","Substituir IECA universalmente","Elevar pot√°ssio"], a:1, e:"Estudos robustos mostram redu√ß√£o de progress√£o renal e eventos cardiovasculares.", r:["dapa","empa"] },
      { d:2, q:"Na s√≠ndrome nefr√≠tica ativa, sedimento sugestivo:", o:["C√©lulas escamosas","Cilindros hem√°ticos","Pi√∫ria isolada","Cristais de cistina"], a:1, e:"Cilindros hem√°ticos sugerem origem glomerular do sangramento.", r:["kdigo_gn"] },
      { d:3, q:"Acidose metab√≥lica cr√¥nica da DRC: alvo de bicarbonato geralmente:", o:["<18 mEq/L","22‚Äì26 mEq/L","30‚Äì35 mEq/L","~40 mEq/L"], a:1, e:"Manter bicarbonato na faixa normal/normal-baixa √© pr√°tica usual.", r:["kdigo_ckd"] },
      { d:3, q:"Complica√ß√£o metab√≥lica √≥ssea comum na DRC avan√ßada:", o:["PTH reduzido persistente","F√≥sforo e PTH elevados","Calcitriol espontaneamente alto","Hipofosfatemia universal"], a:1, e:"Reten√ß√£o de f√≥sforo e queda de calcitriol favorecem hiperparatireoidismo secund√°rio.", r:["kdigo_mbd"] },
      { d:3, q:"Na s√≠ndrome nefr√≥tica, risco tromb√≥tico cresce quando:", o:["Albumina s√©rica muito baixa","Ureia levemente alta","pH urin√°rio alcalino","IECA em uso"], a:0, e:"Hipoalbuminemia importante associa-se a hipercoagulabilidade em s√≠ndromes nefr√≥ticas.", r:["kdigo_gn"] },
      { d:3, q:"No diferencial da hiponatremia, a osmolaridade plasm√°tica serve para:", o:["Confirmar SIADH sozinha","Separar hipo/iso/hipert√¥nica","Substituir exame cl√≠nico","Indicar di√°lise imediata"], a:1, e:"A osmolaridade ajuda a identificar mecanismo e evitar pseudo-hiponatremia.", r:["hypona"] },
      { d:4, q:"Indica√ß√£o cl√°ssica de di√°lise urgente na IRA:", o:["Creatinina 1,8 sem sintomas","Ureia discretamente alta","Edema agudo de pulm√£o refrat√°rio","Anemia normoc√≠tica"], a:2, e:"Sobrecarga vol√™mica com insufici√™ncia respirat√≥ria refrat√°ria √© indica√ß√£o cl√°ssica.", r:["kdigo_aki"] },
      { d:4, q:"Em anti-MBG rapidamente progressiva, manejo t√≠pico inclui:", o:["Apenas observa√ß√£o","Corticoterapia + imunossupress√£o ¬± plasmaf√©rese","S√≥ diur√©tico","Antibi√≥tico isolado"], a:1, e:"Conduta precoce agressiva pode preservar fun√ß√£o renal em doen√ßa anti-MBG.", r:["kdigo_gn"] },
      { d:4, q:"Qual medida reduz nefrotoxicidade de inibidor de calcineurina p√≥s-transplante?", o:["Evitar monitoriza√ß√£o","Ajustar dose por n√≠veis s√©ricos","AINE cr√¥nico","Suspender anti-hipertensivo"], a:1, e:"Monitoriza√ß√£o farmacol√≥gica √© essencial para equil√≠brio entre efic√°cia e seguran√ßa.", r:["transplant"] },
      { d:4, q:"Na DRC avan√ßada, estrat√©gia nutricional mais alinhada a diretrizes:", o:["Hiperproteica irrestrita","Prote√≠na individualizada com suporte nutricional","Sem controle de s√≥dio","F√≥sforo liberado"], a:1, e:"Planejamento nutricional individualizado melhora controle metab√≥lico e uremia.", r:["kdoqi"] },
      { d:5, q:"Em IRA intr√≠nseca por necrose tubular aguda, padr√£o mais comum:", o:["FENa frequentemente >2%","FENa sempre <1%","Urina sem cilindros granulosos","Na urin√°rio invariavelmente baixo"], a:0, e:"Na NTA, h√° perda de capacidade tubular de reabsor√ß√£o de s√≥dio em muitos casos.", r:["kdigo_aki"] },
      { d:5, q:"Na DRC com albumin√∫ria persistente apesar de IECA/BRA, estrat√©gia adicional com evid√™ncia:", o:["iSGLT2 se eleg√≠vel","AINE di√°rio","Suspender todo anti-hipertensivo","Hiperprote√≠na"], a:0, e:"Ensaios DAPA-CKD e EMPA-KIDNEY suportam benef√≠cio renal adicional.", r:["dapa","empa"] },
      { d:5, q:"Na avalia√ß√£o de DRC, tend√™ncia da TFG deve ser:", o:["Avaliou uma vez, basta","Monitorada longitudinalmente","Substitu√≠da por ureia","Ignorada se sem edema"], a:1, e:"A trajet√≥ria da TFG orienta risco e decis√µes terap√™uticas.", r:["kdigo_ckd"] },
      { d:5, q:"Qual crit√©rio favorece glomerulopatia membranosa prim√°ria sobre secund√°ria?", o:["Aus√™ncia de anti-PLA2R sempre","Anti-PLA2R positivo + contexto compat√≠vel","Hemocultura positiva","Bacteri√∫ria maci√ßa"], a:1, e:"Anti-PLA2R positivo pode apoiar etiologia prim√°ria em cen√°rio cl√≠nico adequado.", r:["kdigo_gn"] },
      { d:5, q:"Meta press√≥rica em DRC deve ser definida:", o:["Sem rela√ß√£o com albumin√∫ria","Pelo risco global e diretrizes","Apenas pela idade","S√≥ pela ureia"], a:1, e:"Controle press√≥rico individualizado √© pilar da nefroprote√ß√£o.", r:["kdigo_ckd"] },
      { d:6, q:"Paciente com DRC e hipercalemia recorrente em IECA/BRA: conduta geral moderna tende a:", o:["Suspender definitivamente em todos","Tentar manter benef√≠cio com estrat√©gias de controle do K","Ignorar K elevado","Trocar por AINE"], a:1, e:"Quando poss√≠vel, busca-se manter terapias nefroprotetoras com manejo da hipercalemia.", r:["kdigo_ckd"] },
      { d:6, q:"Em SIADH, achado t√≠pico (ap√≥s exclus√µes):", o:["Urina muito dilu√≠da persistente","Osm urin√°ria inapropriadamente elevada","Hiperosmolaridade plasm√°tica","Poli√∫ria osm√≥tica por glicose"], a:1, e:"SIADH costuma cursar com urina inadequadamente concentrada apesar de hiponatremia.", r:["hypona"] },
      { d:6, q:"No transplante renal, monitorar fun√ß√£o do enxerto inclui:", o:["S√≥ press√£o arterial","Creatinina/tend√™ncia + contexto cl√≠nico","Apenas peso","Somente urina 1 vez ao ano"], a:1, e:"Acompanhamento integrado detecta rejei√ß√£o, toxicidade e complica√ß√µes precoces.", r:["transplant"] },
      { d:6, q:"Em DRC est√°gio avan√ßado, vacina√ß√£o √©:", o:["Dispens√°vel","Parte importante do cuidado global","Contraindicada por padr√£o","Feita s√≥ ap√≥s di√°lise"], a:1, e:"Preven√ß√£o infecciosa integra cuidado longitudinal em doen√ßa renal cr√¥nica.", r:["kdigo_ckd"] },
      { d:6, q:"Em suspeita de GN rapidamente progressiva, tempo para investiga√ß√£o/tratamento:", o:["Pode aguardar meses","√â cr√≠tico e geralmente urgente","Apenas ap√≥s di√°lise","Sem impacto progn√≥stico"], a:1, e:"Atraso pode levar √† perda renal irrevers√≠vel.", r:["kdigo_gn"] },
      { d:7, q:"No DRC-MBD, monitoriza√ß√£o laboratorial deve considerar:", o:["S√≥ c√°lcio anual","C√°lcio, f√≥sforo, PTH e tend√™ncia cl√≠nica","Apenas vitamina C","Somente magn√©sio"], a:1, e:"O conjunto de marcadores orienta manejo individualizado do metabolismo mineral.", r:["kdigo_mbd"] },
      { d:7, q:"A interpreta√ß√£o da albumin√∫ria isolada deve considerar:", o:["Exerc√≠cio, febre e contexto cl√≠nico","Somente sexo biol√≥gico","Somente idade","Nenhum fator transit√≥rio"], a:0, e:"Condi√ß√µes transit√≥rias podem alterar albumin√∫ria e exigir confirma√ß√£o.", r:["kdigo_ckd"] },
      { d:7, q:"Na DRC diab√©tica, associa√ß√£o de iSGLT2 e bloqueio SRAA em eleg√≠veis visa:", o:["Perda de massa √≥ssea","Prote√ß√£o cardiorrenal adicional","Eliminar monitoriza√ß√£o","Substituir toda terapia"], a:1, e:"Estrat√©gias combinadas podem trazer benef√≠cio incremental de desfechos.", r:["kdigo_ckd","dapa","empa"] },
      { d:7, q:"Em hiponatremia cr√¥nica, corre√ß√£o r√°pida excessiva pode causar:", o:["Hipertens√£o pulmonar","S√≠ndrome de desmieliniza√ß√£o osm√≥tica","Glomeruloesclerose imediata","Nefrocalcinose"], a:1, e:"A corre√ß√£o deve ser cautelosa para reduzir risco neurol√≥gico grave.", r:["hypona"] },
      { d:7, q:"Em paciente com edema e protein√∫ria importante, abordagem inicial inclui:", o:["Apenas repouso","Avalia√ß√£o etiol√≥gica + controle hemodin√¢mico e protein√∫ria","Somente antibi√≥tico","AINE de rotina"], a:1, e:"√â essencial tratar risco, causa e manifesta√ß√µes da s√≠ndrome glomerular.", r:["kdigo_gn"] },
      { d:8, q:"Bi√≥psia renal em DRC √© indicada quando:", o:["Nunca √© necess√°ria","Achados mudam conduta/diagn√≥stico","Sempre em TFG <60","Somente por dor lombar"], a:1, e:"A bi√≥psia √© √∫til quando o resultado impacta tratamento e progn√≥stico.", r:["kdigo_gn"] },
      { d:8, q:"No cuidado pr√©-di√°lise, decis√£o de iniciar TRS deve considerar:", o:["Apenas creatinina","Sintomas ur√™micos, volume, eletr√≥litos e contexto global","Somente idade","S√≥ hemat√≥crito"], a:1, e:"Indica√ß√£o √© cl√≠nica e laboratorial integrada, n√£o apenas um n√∫mero isolado.", r:["kdigo_ckd"] },
      { d:8, q:"Em protein√∫ria persistente, interven√ß√£o n√£o farmacol√≥gica relevante:", o:["Sem restri√ß√£o de s√≥dio","Controle de s√≥dio e estilo de vida","Aumentar ultraprocessados","Suspender atividade f√≠sica para sempre"], a:1, e:"Medidas de estilo de vida e s√≥dio potencializam tratamento farmacol√≥gico.", r:["kdoqi"] },
      { d:8, q:"Em pot√°ssio elevado recorrente, al√©m de f√°rmacos, revisar:", o:["Apenas vitaminas","Dieta, substitutos de sal e medicamentos contribuintes","Somente ingest√£o h√≠drica","Apenas glicemia"], a:1, e:"Manejo multifatorial ajuda a manter terapias nefroprotetoras.", r:["kdigo_ckd"] },
      { d:8, q:"No enxerto renal, queda aguda da fun√ß√£o pede:", o:["Esperar resolu√ß√£o espont√¢nea","Avalia√ß√£o imediata de causas pr√©/intra/p√≥s-renais e rejei√ß√£o","Apenas diur√©tico","Suspender toda imunossupress√£o"], a:1, e:"A avalia√ß√£o precoce pode evitar dano irrevers√≠vel ao enxerto.", r:["transplant"] },
      { d:9, q:"Na DRC com doen√ßa cardiovascular, benef√≠cio de tratamento integrado ocorre por:", o:["A√ß√£o isolada em um fator","Controle simult√¢neo de PA, albumin√∫ria, glicemia e estilo de vida","Somente redu√ß√£o de peso","Somente diur√©tico"], a:1, e:"Abordagem multifatorial √© central na redu√ß√£o de risco global.", r:["kdigo_ckd"] },
      { d:9, q:"Em GN com crescentes, atraso terap√™utico tende a:", o:["N√£o alterar desfecho","Aumentar risco de perda de fun√ß√£o renal","Melhorar espontaneamente","Reduzir necessidade de monitoriza√ß√£o"], a:1, e:"O tempo √© determinante em doen√ßas glomerulares agressivas.", r:["kdigo_gn"] },
      { d:9, q:"Na avalia√ß√£o da hiponatremia, volume extracelular √© importante porque:", o:["Nunca muda conduta","Orienta etiologia e tratamento","S√≥ importa no idoso","Substitui osmolaridade"], a:1, e:"A an√°lise de volume orienta algoritmo diagn√≥stico e terap√™utico.", r:["hypona"] },
      { d:9, q:"No acompanhamento da DRC, educa√ß√£o do paciente √© relevante para:", o:["Apenas ades√£o medicamentosa","Autocuidado, ades√£o e reconhecimento precoce de sinais de alarme","Evitar consultas","Reduzir hidrata√ß√£o"], a:1, e:"Educa√ß√£o melhora desfechos e engajamento no tratamento longitudinal.", r:["kdigo_ckd"] },
      { d:10, q:"Na decis√£o de imunossupress√£o em glomerulopatias, deve-se ponderar:", o:["S√≥ protein√∫ria do dia","Risco-benef√≠cio individual e perfil de atividade da doen√ßa","Somente idade","Apenas ultrassom"], a:1, e:"Estratifica√ß√£o individual evita sobretratamento e subtratamento.", r:["kdigo_gn"] },
      { d:10, q:"Em DRC avan√ßada, planejamento de TRS idealmente ocorre:", o:["Apenas em urg√™ncia dial√≠tica","De forma antecipada e compartilhada","Somente ap√≥s interna√ß√£o","Nunca antes de eGFR <5"], a:1, e:"Planejamento pr√©vio melhora preparo, acesso e escolha informada.", r:["kdigo_ckd"] },
      { d:10, q:"Uso de calcineur√≠nico p√≥s-transplante exige vigil√¢ncia por risco de:", o:["Apenas tosse seca","Nefrotoxicidade e ajuste terap√™utico fino","Hipoglicemia grave universal","An√∫ria fisiol√≥gica"], a:1, e:"Janela terap√™utica estreita requer monitoriza√ß√£o laboratorial regular.", r:["transplant"] },
      { d:10, q:"Em DRC, descontinuidade de seguimento est√° associada a:", o:["Menor risco","Pior controle de fatores de progress√£o","Indiferen√ßa cl√≠nica","Curva est√°vel obrigat√≥ria"], a:1, e:"Seguimento estruturado √© crucial para retardar progress√£o e complica√ß√µes.", r:["kdigo_ckd"] },
      { d:11, q:"Corre√ß√£o de hiponatremia com alvo excessivo em 24h aumenta risco de:", o:["Hipotireoidismo","Les√£o osm√≥tica neurol√≥gica","Nefrite intersticial","Rabdomi√≥lise renal espec√≠fica"], a:1, e:"A velocidade de corre√ß√£o √© determinante para seguran√ßa neurol√≥gica.", r:["hypona"] },
      { d:11, q:"No manejo avan√ßado de DRC, integra√ß√£o nefro-cardio-end√≥crino √© √∫til por:", o:["Duplicar exames sem ganho","Sinergia terap√™utica em risco cardiorrenal","Eliminar necessidade de nefrologista","Substituir diretrizes"], a:1, e:"Converg√™ncia de terapias melhora desfechos em m√∫ltiplos eixos.", r:["kdigo_ckd"] },
      { d:11, q:"Em suspeita de recorr√™ncia de doen√ßa glomerular no enxerto, conduta:", o:["Ignorar bi√≥psia","Investigar precocemente com abordagem dirigida","Tratar empiricamente sem avalia√ß√£o","Suspender toda terapia de base"], a:1, e:"Diagn√≥stico etiol√≥gico precoce orienta interven√ß√£o e preserva√ß√£o do enxerto.", r:["transplant","kdigo_gn"] },
      { d:11, q:"Monitoriza√ß√£o de albumin√∫ria ap√≥s interven√ß√£o terap√™utica serve para:", o:["Sem valor progn√≥stico","Avaliar resposta e risco residual","Apenas confirmar coleta","Excluir DRC"], a:1, e:"Mudan√ßas na albumin√∫ria podem refletir resposta terap√™utica e progn√≥stico.", r:["kdigo_ckd"] },
      { d:12, q:"Na abordagem personalizada da DRC, o conceito-chave √©:", o:["Tratamento √∫nico para todos","Estratifica√ß√£o de risco e terapia individualizada","Sem necessidade de metas","Foco exclusivo em ureia"], a:1, e:"Individualizar conforme risco, comorbidades e prefer√™ncias melhora resultados.", r:["kdigo_ckd"] },
      { d:12, q:"Diante de IRA complexa em paciente cr√≠tico, estrat√©gia adequada inclui:", o:["Decis√£o isolada sem contexto","Reavalia√ß√£o din√¢mica hemodin√¢mica/metab√≥lica e timing de TRS","S√≥ repetir creatinina","Aguardar an√∫ria completa"], a:1, e:"A IRA cr√≠tica exige avalia√ß√£o cont√≠nua e decis√µes adaptativas.", r:["kdigo_aki"] },
      { d:12, q:"Meta central do cuidado nefrol√≥gico moderno:", o:["Tratar laborat√≥rio isolado","Reduzir progress√£o, eventos CV e melhorar qualidade de vida","Aumentar interven√ß√µes sem alvo","Evitar educa√ß√£o do paciente"], a:1, e:"O foco √© desfecho cl√≠nico significativo e cuidado centrado no paciente.", r:["kdigo_ckd"] },
      { d:12, q:"Em glomerulopatias raras, decis√£o terap√™utica ideal combina:", o:["Apenas opini√£o isolada","Diretriz, evid√™ncia, bi√≥psia e contexto cl√≠nico individual","Exclusivamente creatinina","Somente sintoma de edema"], a:1, e:"Integra√ß√£o de dados aumenta precis√£o diagn√≥stica e terap√™utica.", r:["kdigo_gn"] },
      { d:6, q:"Em adulto de 40 anos com creatinina 1,50 mg/dL, TFGe 57 ml/min/1,73m¬≤ repetida, sedimento inocente e US normal, melhor pr√≥ximo passo para estimar TFG?", o:["Clearance de creatinina 24h como padr√£o","Bi√≥psia renal imediata","Dosar cistatina C e usar equa√ß√£o combinada creatinina+cistatina","Repetir apenas ureia"], a:2, e:"Nessa situa√ß√£o ambulatorial, a cistatina C em conjunto com creatinina melhora a estimativa da TFG; o clearance de 24h tende a superestimar e tem baixa reprodutibilidade.", r:["kdigo_ckd"] },
      { d:6, q:"Sobre f√≥rmulas para fun√ß√£o renal no ambulat√≥rio, qual afirma√ß√£o √© mais adequada?", o:["Cockcroft-Gault substituiu todas as demais","CKD-EPI 2021 mant√©m crit√©rio de etnia","Cockcroft-Gault est√° em desuso geral, mas pode ajudar no ajuste de dose de alguns f√°rmacos","Nenhuma f√≥rmula √© √∫til para ajuste de dose"], a:2, e:"CKD-EPI 2021 removeu o crit√©rio de etnia; Cockcroft-Gault ainda pode ser √∫til para algumas medica√ß√µes, especialmente certos antimicrobianos.", r:["kdigo_ckd"] },
      { d:7, q:"Sobre cistatina C, a alternativa correta √©:", o:["Deve ser medida em urina de 24h para clearance","N√£o sofre influ√™ncia cl√≠nica extra-renal","Com creatinina, refina a estimativa da TFG","√â inferior √† creatinina em todos os cen√°rios"], a:2, e:"A associa√ß√£o creatinina+cistatina costuma melhorar acur√°cia da TFG estimada; cistatina C pode sofrer influ√™ncia de inflama√ß√£o e tireoidopatias.", r:["kdigo_ckd"] },
      { d:5, q:"Mulher de 66 anos com DM2, TFGe 40 e protein√∫ria 1,9 g/24h: terapia de escolha para nefroprote√ß√£o inicial?", o:["AINE cont√≠nuo","IECA ou BRA","Diur√©tico isolado","Suspender todo anti-hipertensivo"], a:1, e:"Em DRC com protein√∫ria e diabetes, IECA/BRA s√£o primeira linha para reduzir albumin√∫ria e progress√£o renal.", r:["kdigo_ckd"] },
      { d:7, q:"Em rela√ß√£o aos iSGLT2, qual alternativa √© mais correta para monitoriza√ß√£o cl√≠nica?", o:["Sem benef√≠cios cardio-renais","Principal risco √© hipercalcemia","Devem ser evitados em toda DRC","Monitorar infec√ß√µes genitais e cetoacidose euglic√™mica, com benef√≠cios cardio-renais robustos"], a:3, e:"iSGLT2 t√™m benef√≠cio cardiorrenal consistente; efeitos adversos relevantes incluem infec√ß√µes genitais e cetoacidose euglic√™mica em cen√°rios espec√≠ficos.", r:["dapa","empa","kdigo_ckd"] },
      { d:8, q:"Sobre finerenona na DRC diab√©tica, qual √© a afirma√ß√£o correta?", o:["Indicada com albumin√∫ria independente de DM em qualquer cen√°rio","Sem evid√™ncia em DM2 com albumin√∫ria","Pode beneficiar DM2 com albumin√∫ria persistente apesar de IECA/BRA e pot√°ssio monitorado","Contraindicada se houver uso de IECA/BRA"], a:2, e:"Evid√™ncias principais de finerenona s√£o em DM2 com albumin√∫ria persistente apesar de terapia padr√£o, com vigil√¢ncia de pot√°ssio.", r:["kdigo_ckd"] },
      { d:7, q:"Na doen√ßa renal do diabetes, primeira linha farmacol√≥gica (sem contraindica√ß√µes) hoje costuma incluir:", o:["Metformina + iSGLT2","Insulina + AINE","Somente sulfonilureia","Apenas dieta sem f√°rmacos"], a:0, e:"Para muitos pacientes com DM2 e DRC, metformina + iSGLT2 √© estrat√©gia inicial importante; em geral n√£o se inicia iSGLT2 se TFGe <20.", r:["kdigo_ckd","dapa","empa"] },
      { d:6, q:"Paciente em empagliflozina com discreta eleva√ß√£o inicial da creatinina, est√°vel clinicamente. Conduta mais apropriada:", o:["Suspender definitivamente iSGLT2","Manter e monitorar, pois dip inicial de TFG pode ser esperado","Trocar por AINE","Iniciar corticoterapia"], a:1, e:"Pequena queda inicial de TFG (dip hemodin√¢mico) pode ocorrer com iSGLT2 e costuma ser transit√≥ria, devendo-se monitorar contexto cl√≠nico.", r:["dapa","empa","kdigo_ckd"] },
      { d:9, q:"Paciente em dapagliflozina, m√∫ltiplos diur√©ticos e aumento >30% da creatinina: melhor conduta inicial em geral:", o:["Suspender iSGLT2 de imediato sem avaliar volume","Aumentar diur√©ticos","Rever/ajustar diur√©ticos e status vol√™mico antes de retirar iSGLT2","Iniciar antibi√≥tico"], a:2, e:"Quando h√° contra√ß√£o vol√™mica e polifarm√°cia diur√©tica, prioriza-se ajuste vol√™mico/diur√©ticos; iSGLT2 pode ser reintroduzido ap√≥s compensa√ß√£o.", r:["kdigo_ckd","dapa"] },
      { d:8, q:"Em DM2 com albumin√∫ria persistente apesar de IECA/BRA e pot√°ssio adequado, h√° evid√™ncia de benef√≠cio com:", o:["Antagonista seletivo do receptor mineralocorticoide (ex.: finerenona)","AINE em dose plena","Suspens√£o de todo bloqueio do SRAA","Glicos√∫ria terap√™utica por dieta"], a:0, e:"H√° evid√™ncia de benef√≠cio cardiorrenal de antagonista seletivo do receptor mineralocorticoide em pacientes selecionados com DM2 e albumin√∫ria persistente.", r:["kdigo_ckd"] },
    ];

    const itemTable = {
      weapon: [
        { n:"Bisturi Basal", rar:"common", atk:2, def:0, kno:1, luck:0 },
        { n:"L√¢mina Glomerular", rar:"rare", atk:5, def:1, kno:2, luck:1 },
        { n:"Espada da Filtra√ß√£o", rar:"epic", atk:9, def:2, kno:3, luck:1 },
        { n:"Excalibur Nefr√¥nica", rar:"legendary", atk:14, def:3, kno:5, luck:3 }
      ],
      armor: [
        { n:"Avental de Resid√™ncia", rar:"common", atk:0, def:2, kno:1, luck:0 },
        { n:"Peitoral Renocortical", rar:"rare", atk:1, def:5, kno:2, luck:0 },
        { n:"Armadura da Al√ßa de Henle", rar:"epic", atk:2, def:8, kno:2, luck:1 },
        { n:"√âgide do N√©fron", rar:"legendary", atk:3, def:12, kno:3, luck:2 }
      ],
      artifact: [
        { n:"Anel de Creatinina", rar:"common", atk:0, def:0, kno:2, luck:1 },
        { n:"Amuleto de KDIGO", rar:"rare", atk:1, def:1, kno:4, luck:1 },
        { n:"Orbe da Albumin√∫ria", rar:"epic", atk:2, def:2, kno:6, luck:2 },
        { n:"Rel√≠quia da Nefroprote√ß√£o", rar:"legendary", atk:3, def:3, kno:9, luck:4 }
      ]
    };

    const rarityWeight = ["common","common","common","rare","rare","epic","legendary"];
    const rarityOrder = { common:1, rare:2, epic:3, legendary:4 };

    const state = {
      level: 1,
      xp: 0,
      xpToNext: 120,
      score: 0,
      lives: 3,
      streak: 0,
      gold: 0,
      used: new Set(),
      current: null,
      answered: false,
      equipment: {
        weapon: { n:"Punhos Cl√≠nicos", rar:"common", atk:0, def:0, kno:0, luck:0 },
        armor: { n:"Jaleco B√°sico", rar:"common", atk:0, def:1, kno:0, luck:0 },
        artifact: { n:"Crach√° de Interno", rar:"common", atk:0, def:0, kno:1, luck:0 }
      }
    };

    const $ = (id) => document.getElementById(id);
    const ui = {
      level: $("level"), record: $("record"), score: $("score"), lives: $("lives"),
      heroTitle: $("heroTitle"), avatar: $("avatar"), xpFill: $("xpFill"), xpText: $("xpText"),
      atk: $("statAtk"), def: $("statDef"), kno: $("statKno"), luck: $("statLuck"),
      gold: $("gold"), streak: $("streak"), equipGrid: $("equipGrid"), lootLog: $("lootLog"),
      question: $("question"), options: $("options"), feedback: $("feedback"), refs: $("refs"),
      nextBtn: $("nextBtn"), restartBtn: $("restartBtn")
    };

    const getRecord = () => Number(localStorage.getItem("nefroquest-record") || 0);
    const setRecord = (v) => localStorage.setItem("nefroquest-record", String(v));

    function totalStats() {
      return Object.values(state.equipment).reduce((acc, it) => {
        acc.atk += it.atk; acc.def += it.def; acc.kno += it.kno; acc.luck += it.luck;
        return acc;
      }, { atk:0, def:0, kno:0, luck:0 });
    }

    function heroRank() {
      if (state.level >= 18) return "Arqui-Mestre dos N√©frons";
      if (state.level >= 14) return "Lorde da Filtra√ß√£o";
      if (state.level >= 10) return "Especialista Glomerular";
      if (state.level >= 6) return "Residente Renal";
      return "Aprendiz do N√©fron";
    }

    function avatarEmoji() {
      if (state.level >= 16) return "üõ°Ô∏è";
      if (state.level >= 11) return "‚ö°";
      if (state.level >= 7) return "üß™";
      return "üßô";
    }

    function renderEquipment() {
      const slots = [
        ["weapon", "‚öîÔ∏è Arma"],
        ["armor", "üõ°Ô∏è Armadura"],
        ["artifact", "üîÆ Artefato"]
      ];
      ui.equipGrid.innerHTML = slots.map(([k, title]) => {
        const it = state.equipment[k];
        return `<div class="slot"><strong>${title}:</strong> <span class="rarity-${it.rar}">${it.n}</span><br><small>ATK ${it.atk} | DEF ${it.def} | CONH ${it.kno} | SORTE ${it.luck}</small></div>`;
      }).join("");
    }

    function renderHUD() {
      const st = totalStats();
      ui.level.textContent = state.level;
      ui.record.textContent = getRecord();
      ui.score.textContent = state.score;
      ui.lives.textContent = "‚ù§".repeat(Math.max(0, state.lives)) + "‚ô°".repeat(3 - Math.max(0, state.lives));
      ui.heroTitle.textContent = heroRank();
      ui.avatar.textContent = avatarEmoji();
      ui.avatar.classList.toggle("legendary", state.level >= 14);
      ui.xpFill.style.width = `${Math.min(100, (state.xp / state.xpToNext) * 100)}%`;
      ui.xpText.textContent = `XP ${state.xp} / ${state.xpToNext}`;
      ui.atk.textContent = st.atk;
      ui.def.textContent = st.def;
      ui.kno.textContent = st.kno;
      ui.luck.textContent = st.luck;
      ui.gold.textContent = state.gold;
      ui.streak.textContent = state.streak;
      renderEquipment();
    }

    function chooseQuestion() {
      const cap = Math.min(12, Math.ceil(state.level / 1.5) + 1);
      let pool = questions.map((q, idx) => ({ ...q, idx })).filter(q => q.d <= cap && !state.used.has(q.idx));
      if (!pool.length) {
        state.used.clear();
        pool = questions.map((q, idx) => ({ ...q, idx })).filter(q => q.d <= cap);
      }
      const selected = pool[Math.floor(Math.random() * pool.length)];
      state.used.add(selected.idx);
      return selected;
    }

    function renderRefs(refKeys = []) {
      if (!refKeys.length) {
        ui.refs.innerHTML = "";
        return;
      }
      const list = refKeys.map((k) => {
        const ref = referenceMap[k];
        return `<li><a href="${ref.url}" target="_blank" rel="noopener noreferrer">${ref.label}</a></li>`;
      }).join("");
      ui.refs.innerHTML = `<strong>Refer√™ncias (links ao final da explica√ß√£o):</strong><ul>${list}</ul>`;
    }

    function renderQuestion() {
      state.answered = false;
      state.current = chooseQuestion();
      ui.question.textContent = `[N√≠vel ${state.level} | Dificuldade ${state.current.d}] ${state.current.q}`;
      ui.options.innerHTML = "";
      ui.feedback.className = "feedback";
      ui.feedback.textContent = "Escolha sua resposta para ganhar XP, ouro e loot.";
      renderRefs(state.current.r);
      ui.nextBtn.classList.add("hidden");
      ui.restartBtn.classList.add("hidden");

      state.current.o.forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.type = "button";
        btn.textContent = `${String.fromCharCode(65 + idx)}) ${opt}`;
        btn.addEventListener("click", () => answer(idx, btn));
        ui.options.appendChild(btn);
      });
    }

    function rollRarity(luckBonus = 0) {
      const extra = Math.min(2, Math.floor(luckBonus / 6));
      const pool = [...rarityWeight, ...(extra ? ["rare","epic"].slice(0, extra) : [])];
      return pool[Math.floor(Math.random() * pool.length)];
    }

    function rollItem(diff, luck) {
      const slotKeys = Object.keys(itemTable);
      const slot = slotKeys[Math.floor(Math.random() * slotKeys.length)];
      let items = itemTable[slot];
      const rar = rollRarity(luck + diff);
      items = items.filter(it => it.rar === rar);
      return { slot, item: items[Math.floor(Math.random() * items.length)] };
    }

    function tryEquip(slot, newItem) {
      const old = state.equipment[slot];
      const oldPower = old.atk + old.def + old.kno + old.luck + rarityOrder[old.rar];
      const newPower = newItem.atk + newItem.def + newItem.kno + newItem.luck + rarityOrder[newItem.rar];
      if (newPower > oldPower) {
        state.equipment[slot] = newItem;
        return `‚¨ÜÔ∏è Equipado: ${newItem.n} (${slot})`;
      }
      const salvage = 20 + newPower * 3;
      state.gold += salvage;
      return `üí∞ Item ${newItem.n} convertido em ${salvage} ouro.`;
    }

    function gainXP(amount) {
      state.xp += amount;
      let ups = 0;
      while (state.xp >= state.xpToNext) {
        state.xp -= state.xpToNext;
        state.level += 1;
        state.xpToNext = Math.floor(state.xpToNext * 1.16);
        ups += 1;
        if (state.level % 5 === 0 && state.lives < 3) state.lives += 1;
      }
      return ups;
    }

    function answer(index, clicked) {
      if (state.answered) return;
      state.answered = true;
      const st = totalStats();

      const buttons = [...document.querySelectorAll(".option")];
      buttons.forEach(b => b.disabled = true);

      const correct = state.current.a;
      buttons[correct].classList.add("correct");

      if (index === correct) {
        state.streak += 1;
        const xpGain = 35 + state.current.d * 12 + state.streak * 4 + st.kno * 2;
        const goldGain = 14 + state.current.d * 5 + Math.floor(st.luck / 2);
        state.score += 120 + state.current.d * 24 + st.atk + state.streak * 8;
        state.gold += goldGain;

        const lvlUps = gainXP(xpGain);
        let lootMsg = "";
        const dropChance = Math.min(0.9, 0.38 + state.current.d * 0.04 + st.luck * 0.01);
        if (Math.random() < dropChance) {
          const drop = rollItem(state.current.d, st.luck);
          lootMsg = tryEquip(drop.slot, drop.item);
          ui.lootLog.textContent = `Drop: ${drop.item.n} [${drop.item.rar}] ‚Ä¢ ${lootMsg}`;
        } else {
          ui.lootLog.textContent = `Sem drop desta vez. Continue a streak para melhorar chances.`;
        }

        ui.feedback.className = "feedback good";
        ui.feedback.textContent = `‚úÖ Correto! ${state.current.e} +${xpGain} XP, +${goldGain} ouro.${lvlUps ? ` Level Up x${lvlUps}!` : ""} ${lootMsg}`;
      } else {
        state.streak = 0;
        const blockChance = Math.min(0.4, st.def * 0.015);
        const blocked = Math.random() < blockChance;
        clicked.classList.add("wrong");
        if (!blocked) state.lives -= 1;
        state.score = Math.max(0, state.score - (35 - Math.min(25, st.def)));

        ui.feedback.className = "feedback bad";
        ui.feedback.textContent = blocked
          ? `üõ°Ô∏è Errou, mas sua defesa absorveu o dano! ${state.current.e}`
          : `‚ùå Errou. ${state.current.e}`;
      }

      renderHUD();
      if (state.lives <= 0) {
        finishGame();
      } else {
        ui.nextBtn.classList.remove("hidden");
      }
    }

    function finishGame() {
      if (state.score > getRecord()) setRecord(state.score);
      ui.question.textContent = `Fim da jornada! Voc√™ chegou ao n√≠vel ${state.level} com ${state.score} pontos e ${state.gold} ouro.`;
      ui.options.innerHTML = "";
      ui.feedback.className = "feedback";
      ui.feedback.textContent = "Suas 3 vidas acabaram. Recomece para montar um set lend√°rio ainda melhor.";
      renderRefs(["kdigo_ckd","kdigo_aki","kdigo_gn","dapa","empa","transplant"]);
      ui.nextBtn.classList.add("hidden");
      ui.restartBtn.classList.remove("hidden");
      renderHUD();
    }

    function resetGame() {
      state.level = 1;
      state.xp = 0;
      state.xpToNext = 120;
      state.score = 0;
      state.lives = 3;
      state.streak = 0;
      state.gold = 0;
      state.used.clear();
      state.equipment = {
        weapon: { n:"Punhos Cl√≠nicos", rar:"common", atk:0, def:0, kno:0, luck:0 },
        armor: { n:"Jaleco B√°sico", rar:"common", atk:0, def:1, kno:0, luck:0 },
        artifact: { n:"Crach√° de Interno", rar:"common", atk:0, def:0, kno:1, luck:0 }
      };
      ui.lootLog.textContent = "Nenhum loot ainda. Acerte para dropar itens.";
      renderHUD();
      renderQuestion();
    }

    ui.nextBtn.addEventListener("click", renderQuestion);
    ui.restartBtn.addEventListener("click", resetGame);

    renderHUD();
    renderQuestion();
  </script>
</body>
</html>
